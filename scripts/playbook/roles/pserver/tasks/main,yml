---
- name: install pilotgo-server
  dnf: 
    name: PilotGo-server
    state: present
  register: pilotgo_info
  ignore_errors: yes
- name: exit when pilotgo-server fail install
  fail:  
    msg: 'dnf install PilotGo-server failed'
  when: pilotgo_info.rc != 0
- name: change PilotGo config
  shell: sed -i '/^http_server:/,+1 s/0\.0\.0\.0/{{ groups['standalone'][0] }}/' /opt/PilotGo/server/config_server.yaml
- name: change PilotGo config
  shell: sed -i '/^socket_server:/,+1 s/0\.0\.0\.0/{{ groups['standalone'][0] }}/' /opt/PilotGo/server/config_server.yaml
- name: change PilotGo config
  shell: sed -i '/^mysql:/,+1 s/localhost/{{ groups['standalone'][0] }}/' /opt/PilotGo/server/config_server.yaml
- name: change passwd
  lineinfile: 
    path: /opt/PilotGo/server/config_server.yaml
    regexp: '^#?password'
    line: '  password: {{ mysql_password }}'
    backrefs: yes
- name: change PilotGo config
  shell: sed -i '/^redis:/,+1 s/localhost/{{ groups['standalone'][0] }}/' /opt/PilotGo/server/config_server.yaml
- name: change passwd
  lineinfile: 
    path: /opt/PilotGo/server/config_server.yaml
    regexp: '^#?redis_pwd'
    line: '  redis_pwd: {{ redis_password }}'
    backrefs: yes
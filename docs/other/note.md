# 笔记

## 依赖包
1. 配置：viper



## 关键流程

1. agent注册、注销等流程

2. CVE发现、修复流程

    - 多CVE源支持
    - 单软件包与多CVE的对应关系

3. 权限管理

    - 权限模板，用于定义系统角色
    - 所有资源的细粒度读写权限控制
    - 角色可提供默认权限，
    - 

4. 机器挂载节点

    - 不限制层级的树形管理
    - 机器挂载在最终节点（叶子节点）上

5. 机器操作

    - 写操作需要加分布式锁
    
    期望：所有的机器运维操作都可以通过前端进行
    管理内容：
     - crontab
     - 内核参数配置


6. 内存计算

    - 只在数据库中存储元数据，如果服务重启，则重新从agent拉取数据信息
        在db中存储的数据
        1. 权限配置
        2. 机器挂载节点配置
        3. 机器ip账号信息

        在内存中存储的数据：
        - agent ID、ip、
    - 大部分数据存储在内存或redis中进行计算
        - 心跳（redis）
        - 分布式锁（redis）


7. 分布式可扩展性

    - 并发冲突数据放在redis或者db中
    - 每台server可单独处理请求


8. 监控系统
    prometheus+grafana+pushgateway+alertmanager

8. 插件系统
    打算接入的功能：
     - 日志采集（如loki、ES、kibana）
     - cockpit等




网络通讯：
gnet
tcpx




代码结构：

protocol/：协议定义,如消息码
protocol/event.go：协议定义

